<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RescueLink SOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#020617] text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div id="headerArea" class="text-center mb-8">
        <h1 class="text-4xl font-black text-red-600 italic">RESCUELINK</h1>
        <p class="text-slate-500 text-xs font-bold uppercase mt-2">Kittens Can Code | CS05TS</p>
    </div>

    <div class="w-full max-w-sm">
        
        <div id="step1" style="display: block; text-align: center;">
            <button onclick="handleSOS()" class="bg-red-600 w-52 h-52 rounded-full border-[10px] border-red-900/50 text-2xl font-black shadow-2xl active:scale-95 transition-all">
                SOS
            </button>
            <p class="mt-6 text-slate-500 text-xs font-bold uppercase">Tap to Report</p>
        </div>

        <div id="step2" style="display: none;" class="bg-slate-900 p-8 rounded-3xl border border-white/10 shadow-2xl">
            <h2 class="text-xl font-bold mb-6 text-red-500 uppercase border-l-4 border-red-600 pl-3">Incident Profile</h2>
            <input type="text" id="uName" placeholder="Your Name" class="w-full bg-slate-800 p-4 rounded-xl mb-4 text-white border border-white/5 outline-none">
            
            <select id="eType" class="w-full bg-slate-800 p-4 rounded-xl mb-6 text-white border border-white/5 outline-none appearance-none">
                <option>Road Accident</option>
                <option>Medical Emergency</option>
                <option>Fire Outbreak</option>
            </select>

            <button onclick="handleFinal()" class="w-full bg-red-600 py-4 rounded-xl font-black uppercase tracking-widest hover:bg-red-700 transition-colors">
                Confirm Dispatch
            </button>
        </div>

        <div id="step3" style="display: none;" class="text-center bg-slate-900/50 p-10 rounded-3xl border border-green-500/20">
            <div class="text-green-500 text-6xl mb-4">âœ“</div>
            <h2 class="text-2xl font-black text-white">SIGNAL SENT</h2>
            <p class="text-slate-400 text-sm mt-2">Responders are navigating to you.</p>
        </div>

    </div>

    <script>
        console.log("Script Loaded Successfully");
        var lat = "Searching...";
        var lon = "Searching...";

        function handleSOS() {
            console.log("SOS Clicked");
            // Switch UI immediately no matter what
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';

            // Try GPS in background
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(p) {
                    lat = p.coords.latitude.toFixed(6);
                    lon = p.coords.longitude.toFixed(6);
                    console.log("GPS Locked: " + lat);
                }, function(err) {
                    console.warn("GPS Denied: " + err.message);
                });
            }
        }

       function handleFinal() {
    console.log("Submit Clicked");
    var name = document.getElementById('uName').value || "Anonymous Victim";
    var type = document.getElementById('eType').value;

    var data = {
        name: name,
        type: type,
        lat: lat,
        lon: lon
    };

    // --- NEW PROPER BACKEND CONNECTION ---
    // Replace 'YOUR-TUNNEL-URL' with the link from your terminal
    fetch('https://fast-heads-cough.loca.lt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => console.log("Sent to SQL Server!"))
    .catch(err => console.error("Error connecting to Bridge:", err));
    // -------------------------------------

    // Show success UI
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'block';
}
    </script>
</body>
</html>
